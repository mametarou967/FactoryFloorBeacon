# 集計手順書

> **対象者**: データ回収・レポート生成担当者
> **実施タイミング**: 運用終了後（約3ヶ月後）
> ⚠️ 本手順書は実装完了後に詳細を追記予定です。

---

## 事前に用意するもの

| 品目 | 備考 |
|------|------|
| 作業用PC | Python実行環境がインストール済みであること |
| `person_map.csv` | 運用開始時に作成したUUID↔担当者名の対応表 |

---

## ステップ 1: 各Raspberry Pi からデータを回収する

全6台のRaspberry Piから `events.csv` を作業用PCにコピーします。

### 方法A: PCを持参してSSH接続で取得する

```bash
# （実装後に記載）
# 例: scp pi@<IPアドレス>:~/events.csv ./data/2F-A_events.csv
```

### 方法B: USBメモリにコピーして持ち帰る

```bash
# （実装後に記載）
```

> 💡 各Piのファイルを区別するため、回収時にスキャナーIDをファイル名に付けて保存してください。
> 例: `2F-A_events.csv`, `2F-B_events.csv`, ...

---

## ステップ 2: データを所定のフォルダに配置する

回収した6台分のCSVファイルを以下のフォルダ構成で配置します。

```
data/
├── 2F-A_events.csv
├── 2F-B_events.csv
├── 2F-C_events.csv
├── 3F-A_events.csv
├── 3F-B_events.csv
└── 3F-C_events.csv
```

---

## ステップ 3: レポートを生成する

以下のコマンドを1回実行するだけで全出力が生成されます。

```bash
cd report
python report.py
```

---

## ステップ 4: 出力ファイルを確認する

生成されたファイルは以下の場所に出力されます。

```
output/
├── report.html        # メインレポート（ブラウザで開く）
├── report.csv         # 集計データ（Excelで開ける）
└── graphs/
    ├── floor_total.png          # フロア間往来の総数
    ├── floor_daily.png          # 日別推移
    ├── floor_hourly.png         # 時間帯別頻度
    ├── floor_weekly.png         # 曜日別パターン
    ├── individual_ranking.png   # 個人別往来回数ランキング
    └── individual_hourly.png    # 個人別時間帯パターン
```

### HTMLレポートの閲覧

`report.html` をブラウザで開くとインタラクティブなグラフが表示されます。

```bash
# （実装後に記載）
```

---

## 出力レポートの内容

### フロア単位のグラフ

| グラフ名 | 内容 |
|----------|------|
| 往来総数 | 3ヶ月間の2階↔3階の総往来回数 |
| 日別推移 | 日ごとの往来回数の変化 |
| 時間帯別頻度 | 何時台に往来が多いか |
| 曜日別パターン | 曜日ごとの往来傾向 |

### 個人単位のグラフ

| グラフ名 | 内容 |
|----------|------|
| 往来回数ランキング | 担当者ごとの往来回数の多い順 |
| 個人別時間帯パターン | 担当者ごとの往来が多い時間帯 |

---

## トラブルシューティング

| 症状 | 確認事項 |
|------|----------|
| `report.py` がエラーになる | `data/` フォルダにCSVファイルが正しく配置されているか確認 |
| 担当者名が表示されない | `person_map.csv` が正しい場所にあるか・UUIDが一致しているか確認 |
| 特定のPiのデータがない | 該当するCSVファイルが `data/` フォルダにあるか確認 |
